<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= user.fullName %> â€“ Profile</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/styles/global.css" />
  <link rel="stylesheet" href="/styles/navbar.css" />
  <link rel="stylesheet" href="/styles/post.css" />
  <link rel="stylesheet" href="/styles/profile.css" />
</head>
<body>
  <%- include('partials/navbar', { user: viewer }) %>

  <% const isMyProfile = viewer && viewer._id.toString() === user._id.toString(); %>

  <main class="profile-container">
    <section class="profile-header">
      <div class="profile-avatar">
        <img src="<%= user.profileImageUrl || '/img/default-avatar.png' %>" alt="Profile Image">
      </div>
      <div class="profile-info">
        <h2><%= isMyProfile ? "My Profile" : user.fullName %></h2>
        <p class="username">@<%= user.username %></p>
      
        <div class="profile-stats">
          <div><i class="bi bi-stickies-fill"></i> <%= posts.length %> Posts</div>
          <div><i class="bi bi-people-fill"></i> <%= (user.followers || []).length %> Followers</div>
          <div><i class="bi bi-person-fill-add"></i> <%= (user.following || []).length %> Following</div>
        </div>
      </div>

        <% if (!isMyProfile) { %>
          <form method="POST" action="/follow/<%= user._id %>">
            <button type="submit" class="glass-button follow-btn">
              <i class="bi bi-person-plus-fill"></i> Follow
            </button>
          </form>
        <% } %>
    </section>

    <section class="profile-posts-grid">
      <% posts.forEach(post => { %>
        <%- include('partials/post', { post, user: viewer }) %>
      <% }) %>
    </section>
  </main>

  <script src="/js/navbar.js" defer></script>
  <script src="/js/post.js" defer></script>
</body>
</html>
